<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />

    <title>Control Panel | Welcome</title>
    <link rel="stylesheet" href="../assets/controlpanel/css/foundation.blue.css" />
    <link rel="stylesheet" href="../assets/controlpanel/css/style.blue.css">
    <link rel="stylesheet" href="../assets/controlpanel/css/jquery-te-1.4.0.css">
    <link rel="stylesheet" type="text/css" media="all" href="../assets/controlpanel/css/whhg.css" />
    <script src="../assets/controlpanel/js/modernizr.js"></script>

</head>
<body>

<div class="off-canvas-wrap" data-offcanvas>
<div class="inner-wrap">
<nav class="tab-bar">
    <section class="left-small"><a class="left-off-canvas-toggle menu-icon" ><span></span></a></section>
    <section class="middle tab-bar-section"> <h1 class="title">UNICEF Private Sector Academia Project</h1> </section>
</nav>
<aside class="left-off-canvas-menu">
    <ul class="off-canvas-list">
        <li><label>Template Options</label></li>
        <li><a href="#" id="addEditContentMenuAnchor" class="offCanvasMenuAnchor">Add or edit content</a></li>
        <li><a href="#" id="manageCategoriesMenuAnchor" class="offCanvasMenuAnchor">Manage Categories</a></li>
        <li><a href="#" id="fileManagerMenuAnchor" class="offCanvasMenuAnchor">File Manager</a></li>

        <li><label>General Options</label></li>
        <li><a href="#" id="groupsMenuAnchor" class="offCanvasMenuAnchor">Groups</a></li>
        <li><a href="#">Meta</a></li>
    </ul>
</aside>

<section class="main-section">
<div class="row" id="canvasMainSectionRow">
    <div class="large-12 columns contentSwitchableSection activeSection" id="addEditContentSection">
        <div class="row" id="cpOrangeTopRowSeparator"></div>
        <div class="row" id="postAndimportantWrapperRow">
            <div class="medium-3 large-3 columns noPaddingRight" style="height: 37px;">
                <a><div id="postUpdateButton" class="orangeButton">Post an update</div></a></div>
            <div class="medium-9 large-9 columns" style="height: 37px;">
                <div id="importantLinksDiv" style="overflow:visible !important;">
                    <div id="importantLinksTitle" style="font-size: 13px;font-weight:bold;">Important links</div>
                    <div id="importantLinksDiv1"><a href="http://cdn.knightlab.com/libs/timeline/latest/embed/index.html?source=0AnZhFNZb15rAdEREa0RwUzVyVV9XajlJQlBjN2hHMHc&font=Georgia-Helvetica&maptype=TERRAIN&lang=en&height=650" target="_blank" id="importantLinks1">Timeline</a></div>
                    <div id="importantLinksDiv2"><a href="http://www.aaltoglobalimpact.org/html/index.html" target="_blank" id="importantLinks2">Aalto Global Impact</a></div>
                    <div id="importantLinksDiv3"><a href="https://www.flickr.com/photos/122714417@N06/" target="_blank" id="importantLinks3">AGI Flickr</a></div>
                    <div id="importantLinksDiv4"><a href="#" target="_blank" id="importantLinks4">Instructions</a></div>
                </div>
            </div>
        </div>

        <div class="row" id="newsAndImportantRow" style="margin-top:10px;margin-bottom: 10px;" data-equalizer>
            <div class="medium-6 large-6 columns noPaddingRight" style="overflow: hidden;">
                <div id="newsPanelDiv" data-equalizer-watch>
                    <div id="newsPanelTitle">News</div>
                    <div id="news1" class="newsDiv">
                        <div id="news1date" class="newsDate"></div>
                        <div id="news1text" class="newsText"></div>
                    </div>
                    <div id="news2" class="newsDiv">
                        <div id="news2date" class="newsDate"></div>
                        <div id="news2text" class="newsText"></div>
                    </div>
                    <div id="news3" class="newsDiv">
                        <div id="news3date" class="newsDate"></div>
                        <div id="news3text" class="newsText"></div>
                    </div>
                    <!--
                    <div style="width:100%;text-align:center;">
                        <hr style="background-color:#FFF;color:#FFF;width:90%;border-color:#FFF;height:30px;display: inline-block;margin:0;padding:0;">
                    </div>
                    -->
                </div>
            </div>
            <div class="medium-6 large-6 columns" style="overflow: hidden;">
                <div id="importantPanelDiv" data-equalizer-watch>
                    <div id="importantPanelTitle">Important</div>
                    <div id="important1" class="newsDiv">
                        <div id="important1date" class="newsDate"></div>
                        <div id="important1text" class="newsText"></div>
                    <div id="important2" class="newsDiv">
                        <div id="important2date" class="newsDate"></div>
                        <div id="important2text" class="newsText"></div>
                    </div>
                    <div id="important3" class="newsDiv">
                        <div id="important3date" class="newsDate"></div>
                        <div id="important3text" class="newsText"></div>
                    </div>
                    <!--
                    <div style="width:100%;text-align:center;">
                        <hr style="background-color:#FFF;color:#FFF;width:90%;border-color:#FFF;height:30px;display: inline-block;margin:0;padding:0;">
                    </div>
                    -->
                </div>
            </div>
        </div>

        <div class="row" id="isotope_content_row">
            <div id="ModalsHolderDiv-Content">
                <div id="addNewContentModal" class="reveal-modal medium" data-reveal>
                    <h2>Adding a new update</h2>

                    <div class="row">
                        <div class="large-6 columns">
                            <div style="width: 100%; height: auto;margin: 0px;padding: 0px;">
                                <div style="width: 100%;margin: 0px;padding: 0px;height:300px; background-color:#ccc;text-align: center;">
                                    <input type="file" id="addNewContentModal-ImageData">
                                </div>
                            </div>
                        </div>
                        <div class="large-6 columns">
                            <div style="width: 100%; height: auto;margin: 0px;padding: 0px;">
                                <form id="form-addNewContentModal" method='POST' enctype='multipart/form-data' data-abide="ajax">
                                    <div class="title-field"><label>Title<input type="text" id="addNewContentModal-title" required/></label><small class="error">A title to this update is required.</small></div>
                                    <div class="published-field"><label>Published<input type="text" id="addNewContentModal-published" required/></label><small class="error">Published date this update is required.</small></div>
                                    <div class="excerpt-field"><label>Excerpt<input type="text" id="addNewContentModal-excerpt" required/></label><small class="error">An excerpt to this update is required.</small></div>
                                    <div class="author-field"><label>Author<input type="text" id="addNewContentModal-author" required/></label><small class="error">Please type the author of this update.</small></div>
                                    <div class="categories-field"><label>Category
                                        <select id="addNewContentCategorySelect">
                                        </select>
                                    </label>
                                    </div>
                                    <!--<div class="categories-field"><label>Categories</label> <input type="text" id="addNewContentModal-categories"/></div>-->
                                    <div class="hide"><label>ID</label><input type="text" class="hide" id="addNewContentModal-id"/></div>
                                    <div class="hide"><label>Image Path</label>   <input type="text" class="hide" id="addNewContentModal-imagePath"/></div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="large-12 columns right textAreaEditorDiv"><label>Content</label>
                            <!--
                                                                <textarea id="addNewContentModal-content" cols="50"style="height: 300px;"></textarea>
                                                               <textarea cols="50" id="area4">HTML <b>content</b> <i>default</i> in textarea</textarea>
                            -->
                            <div id="addNewTextareaDivHolder"><textarea id="addNewContentModal-content" style="height: 300px;" name="content"></textarea></div>
                        </div>
                    </div>

                    <div class="row" style="margin-top: 20px;">
                        <div class="large-12 columns">
                            <a class="button" id="cancelAddNewContentModal" style="float: right;">Cancel</a><div style="width: 10px;float: right;">&nbsp;</div>
                            <a class="button" id="addNewContentModal-submit" style="float: right;">Submit</a>
                        </div>
                    </div>

                    <a class="close-reveal-modal">&#215;</a>
                </div>
                <div id="editContentModal" class="reveal-modal medium" data-reveal>
                    <h2>Editing content</h2>
                    <div class="row">
                        <div class="large-6 columns" style="padding-right: 0;">
                            <div style="width: 100%;margin: 0px;padding: 0px;text-align: center;">
                                <input type="file" id="editContentModal-ImageData">
                            </div>
                        </div>
                        <div class="large-6 columns">
                            <div style="width: 100%; height: auto;margin: 0px;padding: 0px;">
                                <form id="form-editContentModal" method='POST' enctype='multipart/form-data' data-abide="ajax">
                                    <div class="title-field"><label>Title<input type="text" id="editContentModal-title" required/></label><small class="error">A title to this update is required.</small></div>
                                    <div class="published-field"><label>Published<input type="text" id="editContentModal-published" required/></label><small class="error">A published date is required.</small></div>
                                    <div class="excerpt-field"><label>Excerpt<input type="text" id="editContentModal-excerpt" required/></label><small class="error">An excerpt to this update is required.</small></div>
                                    <div class="author-field"><label>Author<input type="text" id="editContentModal-author"></label></div>
                                    <div class="categories-field"><label>Category <select id="editContentModal-categories"></select></label></div>
                                    <input type="hidden" id="editContentModal-id"/>
                                    <input type="hidden" id="editContentModal-etag"/>
                                </form>

                            </div>
                        </div>
                    </div>

                    <div class="row"><div class="large-12 columns right textAreaEditorDiv"><label>Content</label><div id="editTextareaDivHolder"></div></div></div>

                    <div class="row" style="margin-top: 20px;"><div class="large-12 columns">
                        <a class="button" id="cancelEditContentModal" style="float: right;">Cancel</a><div style="width: 10px;float: right;">&nbsp;</div>
                        <a class="button" id="editContentModal-submit" style="float: right;">Submit</a></div>
                    </div>
                    <a class="close-reveal-modal">&#215;</a>
                </div>
                <div id="viewContentModal" class="reveal-modal medium" data-reveal>
                    <!--Begins contents of  div for the viewContentModal-->
                    <div class="row">
                        <div class="large-4 columns" id="viewContentModal-image"></div>
                        <div class="large-8 columns">
                            <div class="itemWrapper-fixedWidth" style="padding-right: 10px;padding-bottom: 5px;"><span id="viewContentModal-categories" class="fancyTagBig"></span></div>
                            <div class="itemWrapper-fixedWidth" style="padding-right: 10px;padding-bottom: 5px;"><i class='icon-pencil fancyTextColor font80'></i>&nbsp;<span id="viewContentModal-Author" class="discreetLinks"></span></div>
                            <div class="itemWrapper-fixedWidth" style="padding-right: 10px;padding-bottom: 5px;"><i class='icon-calendaralt-cronjobs fancyTextColor font80'></i>&nbsp;<span id="viewContentModal-Date" class="discreetLinks"></span></div>
                        </div>
                        <div class="large-8 columns" style="padding-right:0;padding-top: 0;padding-bottom:0;"><div class="content-card-line"><hr></div></div>
                        <div class="large-8 columns" style="padding-bottom: 12px;padding-right:10px;padding-top:10px;"><strong><span id="viewContentModal-title" class="hugeTitleText"></span></strong><br></div>
                        <div class="large-8 columns" style="padding-right:15px;"><span  id="viewContentModal-excerpt" class="contentCardExcerpt bigTitleText discreetTextColor"></span></div>
                    </div>
                    <div class="row">
                        <div class="large-12 columns" style="height:20px;"></div>
                    </div>
                    <div class="row">
                        <div class="large-12 columns articleText" id="viewContentModal-content" style="padding-left: 15px !important; padding-right: 15px !important;"></div>
                    </div>

                    <div class="row" id="viewModalcommentarea-row">
                        <div class="large-12 columns">
                            <div id="viewmodalcommentareaph"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="large-12">
                            <br>
                            <a class="button" id="closeViewContentModal" style="float:right !important;">Close</a>
                        </div>
                    </div>
                    <a class="close-reveal-modal">&#215;</a>
                </div> <!--closes div for the viewContentModal-->
                <div id="alert-contentUpdate-successful" class="reveal-modal medium" data-reveal>
                    <h3>The content was updated successfully.
                    </h3>
                    <p id="alert-contentUpdate-successful-variables" style="font-size: 85%;"></p>
                    <a id="close-alert-contentUpdate-successful" class="close-reveal-modal">&#215;</a>
                </div>
                <div id="alert-addNewContent-successful-modal" class="reveal-modal medium" data-reveal>
                    <h3>The new content was sent successfully.
                    </h3>
                    <p id="alert-addNewContent-successful-variables" style="font-size: 85%;"></p>
                    <a id="close-alert-addNewContent-successful" class="close-reveal-modal">&#215;</a>
                </div>
                <div id="alert-contentDelete-confirm" class="reveal-modal medium" data-reveal>
                    <h3>Are you sure you want to delete this item?
                    </h3>
                    <div id="alert-contentDelete-confirm-ID"></div>
                    <div class="row" style="margin-top: 20px;">
                        <div class="large-12 columns">
                            <a class="button" id="cancel-deleteContentModal" style="float: right;">Cancel</a><div style="width: 10px;float: right;">&nbsp;</div>
                            <a class="button" id="confirm-deleteModal-submit" style="float: right;">Confirm</a>
                        </div>
                    </div>
                    <a id="close-alert-contentDelete-confirm" class="close-reveal-modal">&#215;</a>
                </div>

            </div>
            <!-- +++Isotope content starts +++++++++++++++++++++++++++++++++++++++++++++ -->
            <div class="portfolioFilter" id="portfolioFilterDivContainer"></div>
            <div class="large-12 columns" id="contentDivContainer" style="width:100%; margin: auto !important;"></div>
            <!-- +++Isotope content ends +++++++++++++++++++++++++++++++++++++++++++++ -->
        </div>
    </div> <!--Closes div addEditContentSection large12colums-->

    <div class="large-12 columns contentSwitchableSection" id="categoriesSection">
        <h3>ManageCategories</h3>
        <p>Set in the year 0 F.E. ("Foundation Era"), The Psychohistorians opens on Trantor, the capital of the 12,000-year-old Galactic Empire. Though the empire appears stable and powerful, it is slowly decaying in ways that parallel the decline of the Western Roman Empire. Hari Seldon, a mathematician and psychologist, has developed psychohistory, a new field of science and psychology that equates all possibilities in large societies to mathematics, allowing for the prediction of future events. </p>
        <p>Using psychohistory, Seldon has discovered the declining nature of the Empire, angering the aristocratic members of the Committee of Public Safety, the de facto rulers of the Empire. The Committee considers Seldon's views and statements treasonous, and he is arrested along with young mathematician Gaal Dornick, who has arrived on Trantor to meet Seldon. Seldon is tried by the Committee and defends his beliefs, explaining his theories and predictions, including his belief that the Empire will collapse in 500 years and enter a 30,000-year dark age, to the Committee's members.</p>
    </div>

    <div class="large-12 columns contentSwitchableSection" id="fileManagerSection">
        <h3>File Manager</h3>
        <p>Set in the year 0 F.E. ("Foundation Era"), The Psychohistorians opens on Trantor, the capital of the 12,000-year-old Galactic Empire. Though the empire appears stable and powerful, it is slowly decaying in ways that parallel the decline of the Western Roman Empire. Hari Seldon, a mathematician and psychologist, has developed psychohistory, a new field of science and psychology that equates all possibilities in large societies to mathematics, allowing for the prediction of future events. </p>
        <p>Using psychohistory, Seldon has discovered the declining nature of the Empire, angering the aristocratic members of the Committee of Public Safety, the de facto rulers of the Empire. The Committee considers Seldon's views and statements treasonous, and he is arrested along with young mathematician Gaal Dornick, who has arrived on Trantor to meet Seldon. Seldon is tried by the Committee and defends his beliefs, explaining his theories and predictions, including his belief that the Empire will collapse in 500 years and enter a 30,000-year dark age, to the Committee's members.</p>
    </div>

    <div class="large-12 columns contentSwitchableSection" id="groupsSection">
        <h3>Groups Section</h3>
        <p>Set in the year 0 F.E. ("Foundation Era"), The Psychohistorians opens on Trantor, the capital of the 12,000-year-old Galactic Empire. Though the empire appears stable and powerful, it is slowly decaying in ways that parallel the decline of the Western Roman Empire. Hari Seldon, a mathematician and psychologist, has developed psychohistory, a new field of science and psychology that equates all possibilities in large societies to mathematics, allowing for the prediction of future events. </p>
        <p>Using psychohistory, Seldon has discovered the declining nature of the Empire, angering the aristocratic members of the Committee of Public Safety, the de facto rulers of the Empire. The Committee considers Seldon's views and statements treasonous, and he is arrested along with young mathematician Gaal Dornick, who has arrived on Trantor to meet Seldon. Seldon is tried by the Committee and defends his beliefs, explaining his theories and predictions, including his belief that the Empire will collapse in 500 years and enter a 30,000-year dark age, to the Committee's members.</p>
    </div>
</div>
</div>
</section>
<a class="exit-off-canvas"></a>
</div></div>

<!-- Footer -->
<!-- End Footer -->

</div>


<script src="../assets/controlpanel/js/jquery.js"></script>
<script src="../assets/controlpanel/js/foundation.min.js"></script>
<script src="../assets/controlpanel/js/jquery.isotope.js" type="text/javascript"></script>
<script src="../assets/controlpanel/js/jquery.form.min.js"></script>
<script src="../assets/controlpanel/js/redactor.min.js"></script>
<script src="../assets/controlpanel/js/jquery.htmlClean.min.js"></script>
<script src="../assets/controlpanel/js/markdowndeep/MarkdownDeepLib.min.js"></script>
<script src="../assets/oiplib1.0/TheBall.Interface.UI/TemplateModuleManager.js"></script>
<script src="../assets/oiplib1.0/TheBall.Interface.UI/DataConnectionManager.js"></script>
<script src="../assets/oiplib1.0/TheBall.Interface.UI/OperationManager.js"></script>
<link rel="stylesheet" href="../assets/controlpanel/css/redactor.css" />


<!--<script src="js/nicEdit.js"></script>-->
<!--<script src="js/jquery-te-1.4.0.min.js"></script>-->

<script>


    var parseRawTimestampToDate = function(value) {
        var timestamp;
        if(!value)
            timestamp = new Date();
        else {
            timestamp = new Date(value);
            if(isNaN(timestamp))
                timestamp = new Date(parseInt(value.substr(6)));
        }
        return timestamp;
    };

    var ParseRawTimestampToDateString = function(value) {
        //return timestamp.toISOString();
        var timestamp = parseRawTimestampToDate(value);
        return timestamp.getDate() + "." + (timestamp.getMonth() + 1) + "." + timestamp.getFullYear();
    };

    var ParseRawTimestampToDateTimeString = function(value) {
        var timestamp = parseRawTimestampToDate(value);
        var day = timestamp.getDate();
        var month = timestamp.getMonth() + 1;
        var year = timestamp.getFullYear();
        var hours = timestamp.getHours();
        var minutes = timestamp.getMinutes();
        var seconds = timestamp.getSeconds();
        return day + "." + month + "." + year
            + " " + hours + ":" + (minutes < 10 ? "0" + minutes : minutes) + ":" + (seconds < 10 ? "0" + seconds : seconds);
    };

    var ParseRawTimestampToISOString = function(value) {
        var timestamp = parseRawTimestampToDate(value);
        return timestamp.toISOString();
    }


    $(document).foundation(
            {
                reveal : {
                    animation: 'fadeAndPop',
                    animation_speed: 250,
                    close_on_background_click: false
                }

            }
    );
</script>

<script>
$(document).ready(function(){
    $.ajaxSetup({cache: true});

    $('#addNewContentModal-content').redactor(
            {   minHeight: 300,
                maxHeight: 350,
                autoresize: false,
                buttons: ['bold', 'italic','alignment','unorderedlist', 'orderedlist','image', 'video', "link"]
            });


    var CommentCollection;
    var GetCommentCountForItemID = function(itemID) {
        var itemComments = $.grep(CommentCollection.CollectionContent, function(elem, index) {
            return elem.TargetObjectID === itemID;
        });
        return itemComments.length;
    };


    $.getJSON("../../AaltoGlobalImpact.OIP/CommentCollection/MasterCollection.json", function(comments) {
        CommentCollection = comments;
        $.when(get_content()).then(function(){
            populateWebsitesMenu_and_groupsTabTable ();
            start_isotope();
            setInterval(reLayout_isotope, 2000);
            console.log( "Isotope fired after getting content, succeed" );
        }).fail(function(){console.log( "something went wrong with getting the content" );});
    });



    $("#postAndimportantWrapperRow").delegate("#postUpdateButton",{ click: reveal_addNewContentModal } );
    $("#contentDivContainer").delegate(".editContentButton",{ click: editContent_PopulateModal} );
    $("#contentDivContainer").delegate(".viewContentButton",{ click: viewContent } );
    $("#contentDivContainer").delegate(".commentContentButton",{ click: launchContentModal } );
    $("#contentDivContainer").delegate(".commentContentButton .icon-pencil",{ click: launchContentModal } );
    $("#contentDivContainer").delegate(".trashContentButton",{ click: launchDeleteConfirmation } );
    $("#portfolioFilterDivContainer").delegate("a",{ click: filter_isotope_items } );
    //$("#addNewContent-fileInput ").change(function (){ triggerToolTipUploadPhoto(); });
    /*$("input:file").change(function (){ triggerToolTipUploadPhoto(); });*/
    $(document).on('close','[data-reveal]', reLayout_isotope);
    $("#contentPanelTab").on('click mouseover',setTimeout('reLayout_isotope', 2000));
    $("#addNewContentModal-submit").on('click', submit_New_Content_Form);
    $(".offCanvasMenuAnchor").on('click', switchActiveCanvasSection);
    $("#fileTab").on('click', get_files);
    $("#cancelAddNewContentModal").on('click', close_NewContent_Modal_Form);
    $("#cancel-deleteContentModal").on('click', close_contentDelete_confirm);
    $("#confirm-deleteModal-submit").on('click', submit_contentDelete_confirm);
    $("#create-group-submit").on('click', submit_New_Group);
    $("#addNewContentModal-imageUpload-submit").on('click', upload_addNewContentModalForm_picture);
    $("#addNewContentModal-imageUpload-submit2").on('click', upload_editedContentModalForm_picture);
    $("#preview-addNewFileForm").on('click', upload_newFile);
    $("#submitform-addNewFileForm").on('click',upload_newFile);
    /*$("#submitform-addNewFileForm").on('click', upload_newFile);*/
    $("#contentDivContainer").on('mouseover',reLayout_isotope);
    $("#editContentModal-submit").on('click', submit_EditedContent_to_Server);
    $("#cancelEditContentModal").click(function () {$('#editContentModal').foundation('reveal', 'close');});
    $("#closeViewContentModal").click(function () { $('#viewContentModal').foundation('reveal', 'close');});
    $("#create-group-button").click(function () {$('#create-group-modal').foundation('reveal', 'open');});

    var tUI = TheBall.Interface.UI;
    var tDCM = new tUI.DataConnectionManager();
    var tOP = new tUI.OperationManager(tDCM);

    function test(){
        alert ("triggered!");
    }

    var saveNewComment = function(commentText, parentTextContentID) {
        var saveData =
        {
            CommentText: commentText,
            TargetObjectID: parentTextContentID,
            TargetObjectDomain: "AaltoGlobalImpact.OIP",
            TargetObjectName: "TextContent"
        };
        tOP.CreateObject("AaltoGlobalImpact.OIP", "Comment", saveData);
        setTimeout(function() {
            ReConnectComments(parentTextContentID);
            return false;
        }, 4000);
    };

    var runKeyPress = function(e) {
        var $newCommentField = $("#addNewCommentField");
        var parentObjectID = $newCommentField.data("ParentObjectID");
        var commentText = $newCommentField.val();
        saveNewComment(commentText, parentObjectID);
        /*alert("Your message: "+commentText+"\nParentObjectID: "+parentObjectID);*/
        return false;
        /*if (e.keyCode == 13) {
            var $newCommentField = $("#addNewCommentField");
            var parentObjectID = $newCommentField.data("ParentObjectID");
            var commentText = $newCommentField.val();
            saveNewComment(commentText, parentObjectID);
            return false;}
        return true;*/
    }

    var deleteComment = function() {
        var commentID = $(this).data("CommentID");
        var parentObjectID = $(this).data("ParentObjectID");
        tOP.DeleteIndependentObject("AaltoGlobalImpact.OIP", "Comment", commentID);
        setTimeout(function() {
            ReConnectComments(parentObjectID);
            return false;
        }, 4000);
        return false;
    };

    var ReConnectComments = function(parentItemID) {
        var $commentPh = $("#viewmodalcommentareaph");
        $commentPh.empty();
        $.getJSON("../../AaltoGlobalImpact.OIP/CommentCollection/MasterCollection.json", function(allComments) {
            var myComments = allComments.CollectionContent.filter(function(item)
            {
                return item.TargetObjectID === parentItemID;
            });
            if(myComments.length > 0) {
                myComments.sort(function(comment1, comment2) {
                    var c1 = comment1.Created;
                    var c2 = comment2.Created;
                    if(c1 < c2)
                        return -1;
                    if(c1 > c2)
                        return 1;
                    return 0;
                });
                $commentPh.append("<div id='viewModal-allCommentsDiv'></div>");
                var $allcommentsHTML = $("#viewModal-allCommentsDiv");
                for(var i = 0; i < myComments.length; i++) {
                    var currComment = myComments[i];
                    var commentText = currComment.CommentText;
                    var lastAuthorName = currComment.LastAuthorName;
                    var created = ParseRawTimestampToDateTimeString(currComment.Created);
                    //var lastModified = ParseRawTimestampToISOString(currComment.LastModified);
                    var $commentLine = $("<div class='viewModal-commentContainer'><hr class='viewModal-hr'><span class='viewModal-commentAuthor-span'>" + lastAuthorName + "</span>"
                        + "<span class='viewModal-commentDate-span'>" + created + "</span><a href='#' class='viewModal-commentDelete-a'>Delete</a><br>"
                        + "<div class='viewModal-commentTextdiv'>" + commentText + "</div>"
                        + "</div>");
                    var $deleteComment = $commentLine.find("a");
                    $deleteComment.data("CommentID", currComment.ID);
                    $deleteComment.data("ParentObjectID", parentItemID);
                    $deleteComment.on("click", deleteComment);
                    /*$commentPh.append($commentLine);*/
                    $allcommentsHTML.append($commentLine);
                }

            }
            /*var $newCommentField = $('<input id="addNewCommentField" placeholder="Add a comment..." class="viewModal-textInputField" type="text">');*/
            var $newCommentField = $('<div class="row"><div class="large-12 columns"><div class="row collapse" id="viewModal-inputField+SendButton-div"><div class="small-10 columns"><input id="addNewCommentField" placeholder="Add a comment..." class="viewModal-textInputField" type="text"></div><div class="small-2 columns"><a href="#" id="viewModal-SendNewComment-Button" class="button secondary postfix">Send</a></div></div></div></div>');
            $commentPh.append($newCommentField);
            var $commentInputField = $("#addNewCommentField");
            $commentInputField.data("ParentObjectID", parentItemID);
            /*alert("ParentObjectID: "+parentItemID);*/
            /*$newCommentField.keypress(runKeyPress);*/
            $("#viewModal-SendNewComment-Button").on("click",runKeyPress );
        });
    };



    function switchActiveCanvasSection (event){
        var triggerid= event.target.id;
        var currentactive=$(".activeSection").attr("id");

        $("#"+currentactive).removeClass("activeSection");

        if (triggerid=="addEditContentMenuAnchor")
            $("#addEditContentSection").addClass("activeSection");

        if (triggerid=="manageCategoriesMenuAnchor")
            $("#categoriesSection").addClass("activeSection");

        if (triggerid=="fileManagerMenuAnchor")
            $("#fileManagerSection").addClass("activeSection");

        if (triggerid=="groupsMenuAnchor")
            $("#groupsSection").addClass("activeSection");
    }

    function populateWebsitesMenu_and_groupsTabTable (){
        // This was previously called "populate_groups_table"...first we initialize (clear) the table:
        $("#groups-table td").remove();
        //--begins: Populating the list of websites TopLeft Navbar and Populates the GroupTables on the Groups TAB
        $.getJSON('json/site_settings.json', function(data) {
            var output="";
            var output2="";
            for (var i in data.sites) {
                //noinspection JSUnfilteredForInLoop
                output+="<li><a href='" + data.sites[i].url + "' target='_blank' style='text-transform:capitalize !important;'>" +
                        data.sites[i].name + "</a></li>";
                output2+="<tr><td style='text-transform:capitalize !important;'>" + data.sites[i].name + "</td>" +
                        "<td style='text-transform:lowercase !important;'>" + data.sites[i].url+"</td></tr>";
            }//ends for loop
            $("#groups-table").append(output2);
            $("#site-dropdown-list").append(output);
        })
    }//--ends: Populating the list of websites TopLeft Navbar and Populates the GroupTables on the Groups TAB


    function submit_EditedContent_to_Server() {
        var edited_content_id = $("#editContentModal-id").val();
        var edited_content_etag = $("#editContentModal-etag").val();
        var edited_content_title = $("#editContentModal-title").val();
        var edited_content_published = $("#editContentModal-published").val();
        var edited_content_excerpt = $("#editContentModal-excerpt").val();
        var edited_content_author = $("#editContentModal-author").val();
        var edited_content_categories = $("#editContentModal-categories option:selected").val();
        var edited_content_content = $("#editContentModal-content").val();

        edited_content_content = $('<div/>').text(edited_content_content).html();
        var saveData = {
            "Title": edited_content_title,
            "Published": edited_content_published,
            "Excerpt": edited_content_excerpt,
            "ENC.RawHtmlContent": edited_content_content,
            "Object_Categories": edited_content_categories,
            Author: edited_content_author
        };
        tOP.AppendBinaryFileValuesToData(edited_content_id, saveData, function() {
            tOP.SaveObject(edited_content_id, edited_content_etag, saveData);
            $('#editContentModal').foundation('reveal', 'close');
            setTimeout(function() {
                $('#alert-contentUpdate-successful').foundation('reveal', 'open');
                location.reload();
                return false;
            }, 2500);
        });
    }

    function editContent_PopulateModal(editEvent)   {
        var clickedEditID= editEvent.target.id.replace("editContentButton-dataID-", '');
        $.getJSON('../../AaltoGlobalImpact.OIP/TextContent/'+clickedEditID+".json", function(contentData) {
            tDCM.SetObjectInStorage(contentData);
            var queryValue="";
            var currentObject=contentData;
            var currentID=currentObject.ID;
            var currentETag=currentObject.MasterETag;
            var currentTitle=currentObject.Title;
            var currentExcerpt=currentObject.Excerpt;
            var currentAuthor=currentObject.Author;
            var currentPublishedDate=ParseRawTimestampToISOString(currentObject.Published);

            // Image support content initiation
            var imageSizeString="256";
            var currentImagePath=currentObject.ImageData
                    ? "../../AaltoGlobalImpact.OIP/MediaContent/" + currentObject.ImageData.ID + "_" + imageSizeString + "x" + imageSizeString + "_crop" + currentObject.ImageData.AdditionalFormatFileExt
                    : null;
            // Initiate binary file elements for image
            $("#editContentModal-ImageData").attr("data-oipfile-filegroupid", "editModal");
            tOP.InitiateBinaryFileElements("editContentModal-ImageData", currentID ,"ImageData", currentImagePath);


            if(currentObject.RawHtmlContent) {
                currentObject.BodyRendered = currentObject.RawHtmlContent;
            } else if(currentObject.Body){
                markdown = new MarkdownDeep.Markdown();
                markdown.SafeMode = true;
                currentObject.BodyRendered = markdown.Transform(currentObject.Body);
            } else
                currentObject.BodyRendered = "";

            var currentArticleBody=currentObject.BodyRendered;
            // Kalle's contemplate fix to Hugo's raw management =>
            // the raw html is at BodyRendered as is, the current markdown rendering is as well now
            // previous problem: if there was markdown-entered data in the article it wasn't working in rawhtml
            var rawbody=currentArticleBody;

            var currentMainCategory="News";


            queryValue=currentID;
            $('#editContentModal-id').val(queryValue);
            queryValue=currentETag;
            $('#editContentModal-etag').val(queryValue);
            $('#editContentModal-title').val(currentTitle);
            $('#editContentModal-published').val(currentPublishedDate);
            $('#editContentModal-excerpt').val(currentExcerpt);

            /*getAndPopulate_Isotope_Filter_Categories ();*/
            getAndPopulateCategoryOptions();

            //check if the "field" Author exists in the JSON file
            /*queryValue=contentData.content[i].Author;*/
            if(currentAuthor == false || currentAuthor ===null || currentAuthor ==="undefined" || currentAuthor ===undefined)
                queryValue="Empty";
            else
                queryValue=currentAuthor;

            $('#editContentModal-author').val(queryValue);

            //suggested Content rendering by Kalle:  queryValue=currentArticleBody;
            //My suggestion: cleaning the "old" articles with markdown and extra styling
            rawbody=rawbody.replace(new RegExp("div", "g"), 'p');
            rawbody=rawbody.replace(new RegExp("<span>", "g"), '');
            rawbody=rawbody.replace(new RegExp("</span>", "g"), '');
            var currentArticleBodyVHugo =$.htmlClean(rawbody, {format:true});
            //ends cleaning the "old" articles with markdown and extra styling
            $('#editTextareaDivHolder').empty();
            var textarea = $("<textarea id='editContentModal-content' style='min-height: 300px;'>");
            $('#editTextareaDivHolder').append(textarea);
            $('#editContentModal-content').val(currentArticleBodyVHugo);
            $('#editContentModal-content').redactor(
                    {   minHeight: 300,
                        maxHeight: 350,
                        autoresize: false,
                        buttons: ['bold', 'italic','alignment','unorderedlist', 'orderedlist','image', 'video', "link"]
                    });

            queryValue=currentImagePath;
            $('#editContentModal-imagePath').val(queryValue);

            //send the correspondent image to the placeholder, but clean its containing div first
            $("#editContentModal-image").empty(); //clean the image Placeholder in the form
            queryValue = "<img src='"+currentImagePath+"' style='width:auto;height:auto;max-height:300px;margin-left:auto;margin-right:auto;'>";
            $("#editContentModal-image").append(queryValue);
            $('#editContentModal').foundation('reveal', 'open');
        }); //ends getJson
    }//ends function editContent

    function launchDeleteConfirmation(editEvent) {
        var clickedEditID= editEvent.target.id.replace("trashContentButton-dataID-", '');
        $("#alert-contentDelete-confirm-ID").empty();
        $("#alert-contentDelete-confirm-ID").append("<p>"+clickedEditID+"</p>");
        $("#alert-contentDelete-confirm-ID").data("DeleteID", clickedEditID);

        $('#alert-contentDelete-confirm').foundation('reveal', 'open');
    }

    function viewContent(editEvent) {
        var clickedEditID= editEvent.target.id.replace("viewContentButton-dataID-", '');
        $.getJSON('../../AaltoGlobalImpact.OIP/TextContent/'+clickedEditID+".json", function(contentData) {
            var queryValue="";
            var currentObject=contentData;
            var currentID=currentObject.ID;
            var currentTitle=currentObject.Title;
            var currentExcerpt=currentObject.Excerpt;
            var currentAuthor=currentObject.Author;
            var imageSizeString="256";
            var currentMainCategory;
            var currentPublishedDate=ParseRawTimestampToDateString(currentObject.Published);
            var recordedJsonDate;
            var pattern;
            var extractedDate;
            var rawbody=currentObject.Body;
            var currentImagePath=currentObject.ImageData
                    ? "../../AaltoGlobalImpact.OIP/MediaContent/" + currentObject.ImageData.ID + "_" + imageSizeString + "x" + imageSizeString + "_crop" + currentObject.ImageData.AdditionalFormatFileExt
                    : null;

            if ((currentObject.Author===null)||(!currentObject.Author)){currentAuthor="Aalto Global Impact";}
            else {currentAuthor=currentObject.Author;}

            if(currentObject.RawHtmlContent)
            {
                currentObject.BodyRendered = currentObject.RawHtmlContent;
            }
            else if(currentObject.Body)
            {
                markdown = new MarkdownDeep.Markdown();
                markdown.SafeMode = true;
                currentObject.BodyRendered = markdown.Transform(currentObject.Body);
            } else
                currentObject.BodyRendered = "";
            var currentArticleBody=currentObject.BodyRendered;
            rawbody = currentArticleBody;

            /*
            //This section processes the "PublishedDate" field on JSON, to the format: DD.MM.YY
            recordedJsonDate = currentPublishedDate;
            pattern = /[0-9]+/; //to find the number within the string, first occurrence.
            recordedJsonDate = (recordedJsonDate.match(pattern))/1000;
            extractedDate= new Date(1000*recordedJsonDate);
            currentPublishedDate = extractedDate.getDate()+".";
            currentPublishedDate+= extractedDate.getMonth()+".";
            currentPublishedDate+= extractedDate.getFullYear();
            //ends processing the "PublishedDate" field on JSON, to the format: DD.MM.YY
            */

            //cleaning the "old" articles with markdown and extra styling
            rawbody=rawbody.replace(new RegExp("div", "g"), 'p');
            rawbody=rawbody.replace(new RegExp("<span>", "g"), '');
            rawbody=rawbody.replace(new RegExp("</span>", "g"), '');
            var currentArticleBodyVHugo =$.htmlClean(rawbody, {format:true});
            //ends cleaning the "old" articles with markdown and extra styling


            $("#viewContentModal-title").empty();
            $('#viewContentModal-title').append(currentTitle);

            $("#viewContentModal-Author").empty();
            $('#viewContentModal-Author').append(currentAuthor);

            $("#viewContentModal-Date").empty();
            $('#viewContentModal-Date').append(currentPublishedDate);

            queryValue="<p>"+currentExcerpt+"</p>";
            $("#viewContentModal-excerpt").empty();
            $('#viewContentModal-excerpt').append(queryValue);

            if(!currentObject.Categories || !currentObject.Categories.CollectionContent)
                currentMainCategory="NEWS";
            else
                currentMainCategory=currentObject.Categories.CollectionContent[0].Title;
            $("#viewContentModal-categories").empty();
            $('#viewContentModal-categories').append(currentMainCategory);

            $("#viewContentModal-content").empty();
            $('#viewContentModal-content').append(currentArticleBodyVHugo);

            //send the correspondent image to the placeholder, but clean its containing div first
            $("#viewContentModal-image").empty(); //clean the image Placeholder in the form
            queryValue = "<img src='"+currentImagePath+"' style='width:auto;height:auto;max-width:350;max-height:450px;margin-left:auto;margin-right:auto;'>";
            $("#viewContentModal-image").append(queryValue);
            ReConnectComments(currentID);
            $('#viewContentModal').foundation('reveal', 'open');
        })//ends getJson
    }//Ends Function ViewContent

    function launchContentModal(editEvent) {
        var clickedEditID= editEvent.target.id.replace("contentAddCommentButton-dataID-", '');
        $.getJSON('../../AaltoGlobalImpact.OIP/TextContent/'+clickedEditID+".json", function(contentData) {
            var queryValue="";
            var currentObject=contentData;
            var currentID=currentObject.ID;
            var currentTitle=currentObject.Title;
            var currentExcerpt=currentObject.Excerpt;
            var currentAuthor=currentObject.Author;
            var imageSizeString="256";
            var currentMainCategory;
            var currentPublishedDate=ParseRawTimestampToDateString(currentObject.Published);
            var recordedJsonDate;
            var pattern;
            var extractedDate;
            /*var rawbody=currentObject.Body;*/
            var currentImagePath=currentObject.ImageData
                    ? "../../AaltoGlobalImpact.OIP/MediaContent/" + currentObject.ImageData.ID + "_" + imageSizeString + "x" + imageSizeString + "_crop" + currentObject.ImageData.AdditionalFormatFileExt
                    : null;

            if ((currentObject.Author===null)||(!currentObject.Author)){currentAuthor="Aalto Global Impact";}
            else {currentAuthor=currentObject.Author;}

            /*if(currentObject.RawHtmlContent)
            {
                currentObject.BodyRendered = currentObject.RawHtmlContent;
            }
            else if(currentObject.Body)
            {
                markdown = new MarkdownDeep.Markdown();
                markdown.SafeMode = true;
                currentObject.BodyRendered = markdown.Transform(currentObject.Body);
            } else
                currentObject.BodyRendered = "";
            var currentArticleBody=currentObject.BodyRendered;
            rawbody = currentArticleBody;*/

            $("#viewContentModal-title").empty();
            $('#viewContentModal-title').append(currentTitle);

            $("#viewContentModal-Author").empty();
            $('#viewContentModal-Author').append(currentAuthor);

            $("#viewContentModal-Date").empty();
            $('#viewContentModal-Date').append(currentPublishedDate);

            queryValue="<p>"+currentExcerpt+"</p>";
            $("#viewContentModal-excerpt").empty();
            $('#viewContentModal-excerpt').append(queryValue);

            if(!currentObject.Categories || !currentObject.Categories.CollectionContent)
                currentMainCategory="NEWS";
            else
                currentMainCategory=currentObject.Categories.CollectionContent[0].Title;
            $("#viewContentModal-categories").empty();
            $('#viewContentModal-categories').append(currentMainCategory);

            $("#viewContentModal-content").empty();
            /*$('#viewContentModal-content').append(currentArticleBodyVHugo);*/

            //send the correspondent image to the placeholder, but clean its containing div first
            $("#viewContentModal-image").empty(); //clean the image Placeholder in the form
            queryValue = "<img src='"+currentImagePath+"' style='width:auto;height:auto;max-width:350;max-height:450px;margin-left:auto;margin-right:auto;'>";
            $("#viewContentModal-image").append(queryValue);
            ReConnectComments(currentID);
            $('#viewContentModal').foundation('reveal', 'open');
        })//ends getJson
    }//Ends Function LaunchCommentModal


    function reLayout_isotope() {
        var $container = $('#contentDivContainer');
        $container.isotope( 'reLayout');
    }

    //--begins: Function get_content
    function get_content(){
        $("#contentDivContainer").empty();
        return $.getJSON('../../AaltoGlobalImpact.OIP/TextContentCollection/MasterCollection.json', function(contentData) {
            var user_content="";
            /*user_content+="<div class='addNewContent' id='addNewContentDiv'><div class='content-card-options'><span style='font-size:1100%;color:#ffffff;font-weight:900; line-height:100px;'>+</span></div>";
             user_content+="<div class='content-card-options'><span class='addNewContentTitle'>Add update</span></div>";
             user_content+="<div class='content-card-options'><span class='addNewContentSubtitle'>(Text, picture or embedded media)</span></div></div>";*/
            var newscounter=1;
            var importantcounter = 1;

            for (var i in contentData.CollectionContent) {
                //noinspection JSUnfilteredForInLoop
                /*var aproxCardSize=contentData.content[i].calculatedCardHeight;
                 if(! aproxCardSize || aproxCardSize==0 || aproxCardSize<210 ){
                 aproxCardSize=210;
                 };*/
                var currentObject=contentData.CollectionContent[i];

                var aproxCardSize=210;
                var currentID=currentObject.ID;
                var currentTitle=currentObject.Title ? currentObject.Title : "";
                var currentExcerpt=currentObject.Excerpt;
                var currentAuthor=currentObject.Author;
                var currentPublishedDate=ParseRawTimestampToDateString(currentObject.Published);
                var recordedJsonDate;
                var pattern;
                var extractedDate;

                //This section processes the "PublishedDate" field on JSON, to the format: DD.MM.YY
                /*
                recordedJsonDate = currentPublishedDate;
                pattern = /[0-9]+/; //to find the number within the string, first occurrence.
                recordedJsonDate = (recordedJsonDate.match(pattern))/1000;
                extractedDate= new Date(1000*recordedJsonDate);
                currentPublishedDate = extractedDate.getDate()+".";
                currentPublishedDate+= extractedDate.getMonth()+".";
                currentPublishedDate+= extractedDate.getFullYear();
                */
                //ends processing the "PublishedDate" field on JSON, to the format: DD.MM.YY

                var imageSizeString="256";
                var currentImagePath=currentObject.ImageData
                        ? "../../AaltoGlobalImpact.OIP/MediaContent/" + currentObject.ImageData.ID + "_" + imageSizeString + "x" + imageSizeString + "_crop" + currentObject.ImageData.AdditionalFormatFileExt
                        : null;

                var currentMainCategory;

                if(!currentObject.Categories|| !currentObject.Categories.CollectionContent ||
                        !currentObject.Categories.CollectionContent.length)
                    currentMainCategory="NEWS";
                else
                    currentMainCategory=currentObject.Categories.CollectionContent[0].Title;

                //-----------------------------begins:Here we get the total number of comments for each update

                var numberOfComments=GetCommentCountForItemID(currentID);
                //-----------------------------ends:Here we get the total number of comments for each update



                user_content+="<div class='content-card "+currentMainCategory+"' id='contentCardDataId-"+currentID+"' style='min-height:"+aproxCardSize+"px'>";
                user_content+="<img src='"+currentImagePath+"' alt='image' id='contentCardImage-dataID-"+currentID+"'/>";
                user_content+="<div class='content-card-title' style='font-size:95%; font-weight:bold; color:#000000;' id='contentCardTitle-dataID-"+currentID+"'>"+currentTitle+"</div>";
                user_content+="<div class='content-card-options'><a class='editContentButton' id='editContentButton-dataID-"+currentID+"'>Edit&nbsp;</a><a class='viewContentButton' id='viewContentButton-dataID-"+currentID+"'>&nbsp;View&nbsp;</a><a class='trashContentButton' id='trashContentButton-dataID-"+currentID+"'>&nbsp;Trash&nbsp;</a><a class='content-card-options-right hide' id='toggleVisibilityContentButton-dataID-"+currentID+"'><i class='icon-eye-open' style='font-size:110%;'></i></a></div>";
                user_content+="<div class='content-card-line'><hr></div>";
                user_content+="<div class='content-card-options'><a class='commentContentButton' id='contentAddCommentButton-dataID-"+currentID+"'><i class='icon-pencil'></i>&nbsp;Comment&nbsp;</a><span class='content-card-options-right' id='contentNumberOfComments-dataID-"+currentID+"'>"+numberOfComments+"&nbsp;<i class='icon-commentround'></i></span></div>";
                user_content+="</div>";

                var isNews = currentMainCategory=="News";
                if (isNews && newscounter<4){
                    $("#news"+newscounter+"date").empty();
                    $("#news"+newscounter+"date").append(currentPublishedDate);
                    var currentnewstext="<a>"+currentTitle+". "+currentExcerpt+"</a>";
                    $("#news"+newscounter+"text").empty();
                    $("#news"+newscounter+"text").append(currentnewstext);
                    newscounter++;
                }
                var isImportant = currentMainCategory=="Important";
                if (isImportant && importantcounter<4){
                    $("#important"+importantcounter+"date").empty();
                    $("#important"+importantcounter+"date").append(currentPublishedDate);
                    var currentimportanttext="<a>"+currentTitle+". "+currentExcerpt+"</a>";
                    $("#important"+importantcounter+"text").empty();
                    $("#important"+importantcounter+"text").append(currentimportanttext);
                    importantcounter++;
                }


            }//ends for loop
            Foundation.libs.equalizer.reflow();
            $("#contentDivContainer").append(user_content).isotope('reLayout');
            /*getAndPopulateCategoryOptions();*/
        })//closes getJSON
    }
    //--ends function get_content();
    function get_files(){
        $("#fileTableDivContainer").empty();
        $('#form-addNewfile-fileUpload').ajaxForm();//initializes the FILE Upload Form
        return $.getJSON('json/files.json', function(contentData) {
            var file_table="";
            file_table+="<table style='table-layout:fixed;width:100%;'><thead><tr><th style='width:20%;max-width: 130px;'>Preview</th><th class='breakwords'>URL</th><th>Description</th><th>Uploaded</th></tr></thead><tbody>";
            for (var i in contentData.fileRepository) {
                //noinspection JSUnfilteredForInLoop
                if( (contentData.fileRepository[i].extension=="jpg") ||
                        (contentData.fileRepository[i].extension=="jpeg")||
                        (contentData.fileRepository[i].extension=="png") ||
                        (contentData.fileRepository[i].extension=="tiff")||
                        (contentData.fileRepository[i].extension=="gif")) {
                    file_table+="<tr><td style='width:20%;max-width: 130px;'><div style='width: 100%;'><img src='"+contentData.fileRepository[i].local_path+"' style='max-width:120px;width:100%;height:auto;'></div></td>";
                }
                else
                    file_table+="<tr><td class='breakwords' style='width:20%;max-width: 130px;'><a href='"+contentData.fileRepository[i].URL+"' style='font-size: 150%;' target='_blank'>"+contentData.fileRepository[i].extension+"</a></td>";

                file_table+="<td class='breakwords' style='width:150px;vertical-align: top;'>"+contentData.fileRepository[i].URL+"</td>";
                file_table+="<td style='vertical-align: top;'>"+contentData.fileRepository[i].description+"</td>";
                file_table+="<td style='vertical-align: top;'>"+contentData.fileRepository[i].upload_date+"</td></tr>";
            }//ends for loop
            file_table+="</tbody></table>";
            $("#fileTableDivContainer").append(file_table);
            $(".breakwords").css('word-wrap', 'break-word');
        })
    }

    function filter_isotope_items(){
        $('.portfolioFilter .current').removeClass('current');
        $(this).addClass('current');
        var $container = $("#contentDivContainer");
        var selector = $(this).attr('data-filter');
        $container.isotope({
            filter: selector,
            animationOptions: {
                duration: 750,
                easing: 'linear',
                queue: false
            }
        });
        return false;
        console.log("Entered 'filter_isotope_items' Function alright.");
    }

    function start_isotope(){
        //var $container = $('.portfolioContainer');
        var $container = $("#contentDivContainer");
        $container.isotope({
            filter: '*',
            animationOptions: {
                duration: 750,
                easing: 'linear',
                queue: false
            }
        });

        $('.portfolioFilter a').click(function(){
            $('.portfolioFilter .current').removeClass('current');
            $(this).addClass('current');

            var selector = $(this).attr('data-filter');
            $container.isotope({
                filter: selector,
                animationOptions: {
                    duration: 750,
                    easing: 'linear',
                    queue: false
                }
            });
            return false;
        });
    }//closes function Start_isotope

    function triggerToolTipUploadPhoto(){
        $("#tooltip-choosePhotoHere").trigger("mouseout");
        $("#tooltip-uploadphoto").trigger("mouseover");
    }

    function submit_New_Content_Form(){
        var new_content_content = $('#addNewContentModal-content').val();
        var new_content_title = $("#addNewContentModal-title").val();
        var new_content_published = $("#addNewContentModal-published").val();
        var new_content_excerpt = $("#addNewContentModal-excerpt").val();
        var new_content_categories = $("#addNewContentCategorySelect option:selected").val();
        var new_content_author = $("#addNewContentModal-author").val();

        new_content_content = $('<div/>').text(new_content_content).html();
        var saveData =
        {
            Title: new_content_title,
            Published: new_content_published,
            Excerpt: new_content_excerpt,
            "ENC.RawHtmlContent": new_content_content,
            Object_Categories: new_content_categories,
            Author: new_content_author
        };

        tOP.AppendBinaryFileValuesToData("000", saveData, function() {
            tOP.CreateObject("AaltoGlobalImpact.OIP", "TextContent", saveData);
            $('#addNewContentModal').foundation('reveal', 'close');
            setTimeout(function() {
                $('#alert-addNewContent-successful-modal').foundation('reveal', 'open');
                setTimeout(function() {
                    location.reload();
                    return false;
                }, 2500);
                return false;
            }, 2500);
        });

        $('#addNewContentModal-content').val("");
        $("#addNewContentModal-title").val("");
        $("#addNewContentModal-excerpt").val("");
        $("#addNewContentModal-author").val("");
        $('#addNewTextareaDivHolder').empty();
        var textarea = $("<textarea id='addNewContentModal-content' style='height: 300px;'>");
        $('#addNewTextareaDivHolder').append(textarea);
        $('#addNewContentModal-content').val("");
        $('#addNewContentModal-content').redactor(
                {   minHeight: 300,
                    maxHeight: 350,
                    autoresize: false,
                    buttons: ['bold', 'italic','alignment','unorderedlist', 'orderedlist','image', 'video', "link"]
                });
        //clearing the fileInput
        var newupdatefileinputID = $("#addNewContentModal-ImageData");
        newupdatefileinputID.replaceWith( newupdatefileinputID = newupdatefileinputID.clone( true ) );
        //here the "cleaning" or resetting of the input fields ends.


        return;
        //more stuff to do after the ajax call
        var new_content_id = "123";
        var new_Content="";
        var new_content_image = "";
        new_Content+="<div class='content-card "+new_content_categories+"' id='contentCardDataId-"+new_content_id+"'>";
        new_Content+="<img src='"+new_content_image+"' alt='image' id='contentCardImage-dataID-"+new_content_id+"'/>";
        new_Content+="<div class='content-card-title' id='contentCardTitle-dataID-"+new_content_id+"'><span style='font-size: 120%;'><strong>"+new_content_title+"</strong></span></div>";
        new_Content+="<div class='content-card-options'><a class='editContentButton' id='editContentButton-dataID-"+new_content_id+"'>Edit&nbsp;</a><a class='viewContentButton' id='viewContentButton-dataID-"+new_content_id+"'>&nbsp;View&nbsp;</a><a id='trashContentButton-dataID-"+new_content_id+"'>&nbsp;Trash&nbsp;</a><a class='content-card-options-right' id='toggleVisibilityContentButton-dataID-"+new_content_id+"'><i class='icon-eye-open' style='font-size:110%;'></i></a></div>";
        new_Content+="<div class='content-card-line'><hr></div>";
        new_Content+="<div class='content-card-options'><a><i class='icon-pencil'></i>&nbsp;</a><a id='contentAddCommentButton-dataID-"+new_content_id+"'>&nbsp;Comment&nbsp;</a><a class='content-card-options-right' id='contentNumberOfComments-dataID-"+new_content_id+"'><i class='icon-commentround'></i></a></div>";
        new_Content+="</div>";
        var $container = $('#contentDivContainer');
        var $newItems = $(new_Content);
        $container.isotope( 'insert', $newItems );

        //clearing the fields of the New Content Modal Form
        $('#addNewContentModal-content').val("");
        $("#addNewContentModal-title").val("");
        $("#addNewContentModal-excerpt").val("");
        $("#addNewContentModal-author").val("");
        $("#addNewContentModal-imagePath").val("");
        $("#addNewContentModal-id").val("");
        $('#addNewTextareaDivHolder').empty();
        var textarea = $("<textarea id='addNewContentModal-content' style='height: 300px;'>");
        $('#addNewTextareaDivHolder').append(textarea);
        $('#addNewContentModal-content').val("");
        $('#addNewContentModal-content').redactor(
                {   minHeight: 300,
                    maxHeight: 350,
                    autoresize: false,
                    buttons: ['bold', 'italic','alignment','unorderedlist', 'orderedlist','image', 'video', "link"]
                });
        //clearing the fileInput
        var newupdatefileinputID = $("#addNewContent-fileInput");
        newupdatefileinputID.replaceWith( newupdatefileinputID = newupdatefileinputID.clone( true ) );
        //here the "cleaning" or resetting of the input fields ends.

    }

    function reveal_addNewContentModal () {
        //$('#form-addNewContentModal-imageUpload').ajaxForm();//initializes the Image Upload Form
        //$("#tooltip-choosePhotoHere").trigger("mouseover");

        getAndPopulateCategoryOptions();
        $("#addNewContentModal-ImageData").attr("data-oipfile-filegroupid", "addModal");
        var currentPublished = ParseRawTimestampToISOString(null);
        $("#addNewContentModal-published").val(currentPublished);
        tOP.InitiateBinaryFileElements("addNewContentModal-ImageData", "000" ,"ImageData", null);
        $('#addNewContentModal').foundation('reveal', 'open');
        //getAndPopulate_Isotope_Filter_Categories ();
        //$.when($('#addNewContentModal').foundation('reveal', 'open')).then(function(){$("#tooltip-choosePhotoHere").trigger("mouseover");}).fail(function(){console.log( "Couldn't reveal the addNewContentModal." );});
    }

    function close_NewContent_Modal_Form(){
        $("#tooltip-uploadphoto").trigger("mouseout");
        $("#tooltip-choosePhotoHere").trigger("mouseout");
        //clearing the fields of the New Content Modal Form
        $('#addNewContentModal-content').val("");
        $("#addNewContentModal-title").val("");
        $("#addNewContentModal-excerpt").val("");
        $("#addNewContentModal-author").val("");
        $("#addNewContentModal-imagePath").val("");
        $("#addNewContentModal-id").val("");
        $('#addNewTextareaDivHolder').empty();
        var textarea = $("<textarea id='addNewContentModal-content' style='height: 300px;'>");
        $('#addNewTextareaDivHolder').append(textarea);
        $('#addNewContentModal-content').val("");
        $('#addNewContentModal-content').redactor(
                {   minHeight: 300,
                    maxHeight: 350,
                    autoresize: false,
                    buttons: ['bold', 'italic','alignment','unorderedlist', 'orderedlist','image', 'video', "link"]
                });
        //clearing the fileInput
        var newupdatefileinputID = $("#addNewContent-fileInput");
        newupdatefileinputID.replaceWith( newupdatefileinputID = newupdatefileinputID.clone( true ) );
        //here the "cleaning" or reseting of the input fields ends.

        $('#addNewContentModal').foundation('reveal', 'close');
    }

    function submit_contentDelete_confirm() {
        var objectID = $("#alert-contentDelete-confirm-ID").data("DeleteID");
        tOP.DeleteIndependentObject("AaltoGlobalImpact.OIP", "TextContent", objectID);
        setTimeout(function() {
            $('#alert-contentDelete-confirm').foundation('reveal', 'close');
            location.reload();
            return false;
        }, 3000);
    }


    function close_contentDelete_confirm() {
        $('#alert-contentDelete-confirm').foundation('reveal', 'close');
    }

    function upload_addNewContentModalForm_picture() {
        var options = {
            type: "POST",
            url:'uploadphoto.php',
            success:    function(phpresponse) {
                $("#addNewContentModal-image").empty();
                var imageTag ="<img src='"+phpresponse+"' style='height: 100%; width: auto;'>";
                $("#addNewContentModal-image").append(imageTag);
                //var time_id= $.now();
                $("#addNewContentModal-imagePath").val(phpresponse);
                //$("#addNewContentModal-id").val(time_id);
            }
        };
        $('#form-addNewContentModal-imageUpload').ajaxSubmit(options);
        $("#tooltip-uploadphoto").trigger("mouseout");
        $("#tooltip-choosePhotoHere").trigger("mouseout");
        return false;
    }

    function upload_editedContentModalForm_picture() {
        var options = {
            type: "POST",
            url:'uploadphoto.php',
            success:    function(phpresponse) {
                $("#editContentModal-image").empty();
                var imageTag ="<img src='"+phpresponse+"' style='height: 100%; width: auto;'>";
                $("#editContentModal-image").append(imageTag);
                //var time_id= $.now();
                $("#editContentModal-imagePath").val(phpresponse);
                //$("#addNewContentModal-id").val(time_id);
            }
        };
        $('#form-editContentModal-imageUpload').ajaxSubmit(options);
        $("#tooltip-uploadphoto").trigger("mouseout");
        $("#tooltip-choosePhotoHere").trigger("mouseout");
        return false;
    }

    function upload_newFile() {
        //check if the hidden idFile is already populated... if it's empty it means no file have been selected
        //#form-addNewFileForm-id
        if( !$("#form-addNewFileForm-URL").val() ) {
            var options = {
                type: "POST",
                url:'uploadfile.php',
                success:    function(phpresponse) {
                    $("#addNewfile-image").empty();
                    var imageTag ="<img src='"+phpresponse+"' style='height: 100%; width: auto;'>";
                    $("#addNewfile-image").append(imageTag);
                    //var time_id= $.now();
                    $("#form-addNewFileForm-URL").val(phpresponse);
                    //$("#addNewContentModal-id").val(time_id);
                }
            };
            $('#form-addNewfile-fileUpload').ajaxSubmit(options);
            return false;
        }
        //else, means that the file was already Previewd and uploaded, so we send the rest of the form (description)
        else{
            var filedescription = $("#form-addNewFileForm-description").val();
            var status ="complete";
            var url= $("#form-addNewFileForm-URL").val();
            console.log ("Entered Upload_newFile...Else section. Image URL: "+url+".File description:"+filedescription);

            /*$.ajax({
             global: false,
             type: "POST",
             dataType: "json",
             data: ({
             action: "updateUploadedFileData",
             filedescription: filedescription,
             status: status,
             urltosearch:url
             }),
             url: 'multihandler.php',
             success: function (data) {
             console.log("Success section of the Ajax call to multihandler.php. Response :"+data);
             },
             fail: function(error) {
             console.log ("Call to multihandler.php to update the description failed. Error: "+error);
             }
             });*/
            var multihandlerResponse = $.ajax({
                url: "multihandler.php",
                type: "POST",
                data: ({action: "updateUploadedFileData",
                    filedescription: filedescription,
                    status: status,
                    urltosearch:url}),
                async: false
            }).responseText;
            console.log("Response from ajax call to multihandler.php: "+multihandlerResponse);
            $("#addNewfile-image").empty();
            /*$("#form-addNewFileForm-description").empty();*/
            $("#form-addNewFileForm-description").val("");
            $("#addNewfile-fileInput").val("");
            $("#form-addNewFileForm-URL").val("");
            return false;
        }
    }

    function getAndPopulateCategoryOptions() {
        $.getJSON('../../AaltoGlobalImpact.OIP/CategoryCollection/MasterCollection.json', function(contentData) {
            var categoryoptions="";
            for (var i in contentData.CollectionContent) {
                var currentObject=contentData.CollectionContent[i];
                var currentID=currentObject.ID;
                var currentTitle=currentObject.Title ? currentObject.Title : "";
                categoryoptions+="<option value='"+currentID+"'>"+currentTitle+"</option>";
            }//ends FOR loop
            $("#addNewContentCategorySelect").empty();
            $("#addNewContentCategorySelect").append(categoryoptions);
            $("#editContentModal-categories").empty();
            $("#editContentModal-categories").append(categoryoptions);
            return false;
        })//ends getJson
    }

    function submit_New_Group () {
        var new_group_name = $("#form_new_group_name").val();
        var new_group_url = $("#form_new_group_url").val();
        $.ajax({
            global: false,
            type: "POST",
            //async: false,
            dataType: "json",
            data: ({
                name: new_group_name,
                site: new_group_url
            }),
            url: 'read-write.php'
        });
        //populate_groups_table();
        var new_site="<li><a href='" + new_group_url + "' target='_blank' style='text-transform:capitalize !important;'>" +
                new_group_name + "</a></li>";

        $('#groups-table tr:last').after('<tr><td>'+new_group_name+'</td><td>'+new_group_url+'</td></tr>');
        $("#site-dropdown-list").append(new_site);
        $('#alert-groupadded-successful').foundation('reveal', 'open');
    };


});
</script>

</body>
</html>