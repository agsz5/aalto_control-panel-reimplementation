<!doctype html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The New Global | Co-creating frugal and reverse innovations</title>
    <link rel="stylesheet" href="../assets/css/foundation.orange.css" />
    <link rel="stylesheet" href="../assets/css/style.orange.css">
    <link rel="stylesheet" type="text/css" media="all" href="../assets/css/whhg.css" />
    <script src="../assets/js/modernizr.js"></script>

    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-50665233-1', 'aaltoglobalimpact.org');
        ga('send', 'pageview');

    </script>
</head>
<body>

<!--<div class="aaltoStickyBar contain-to-grid sticky topbar">-->
<div id="stickybar" class="show-for-medium-up">
    <div class="row" id="rowDivMenu">
        <div class="small-12 medium-3 large-3 columns" id="logoDiv" style="display:inline-block;margin:auto;">
            <a href="index.html"><img src="../assets/images/logo2.png" style="width: 100%;max-width: 300px;"></a>
        </div> <!--Closes logoDiv-->
        <div class="small-12 medium-9 large-9 columns" id="logoLinksDiv" style="display:inline-block;">
            <div id="importantLinksDiv" style="overflow:visible !important;">
                <div id="importantLinksDiv1"><a href="index.html"  id="importantLinks1">Front page</a></div>
                <div id="importantLinksDiv2"><a href="research.html"  id="importantLinks2" class="activeLinkTopNavigation">Research</a></div>
                <div id="importantLinksDiv3"><a href="business.html"  id="importantLinks3">Business</a></div>
                <div id="importantLinksDiv4"><a href="innovation.html"  id="importantLinks4">Innovation Platforms</a></div>
                <div id="importantLinksDiv5"><a href="people.html" id="importantLinks5">People</a></div>
            </div>
        </div><!--Closes logoLinksDiv-->
    </div> <!--Closes the menu items row -->
</div>
<!--</div>-->

<!-- alternative TOPBAR for mobile ********************************************* -->
<nav class="top-bar show-for-small-only" data-topbar>
    <ul class="title-area">
        <li class="name"> <h1><a href="index.html">The New Global</a></h1> </li> <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
        <li class="toggle-topbar menu-icon"><a href="#"><span></span></a></li>
    </ul>
    <section class="top-bar-section"> <!-- Right Nav Section -->
        <ul class="right">
            <li class="active"><a href="research.html">Research</a></li>
            <li><a href="business.html">Business</a></li>
            <li><a href="innovation.html">Innovation Platforms</a></li>
            <li><a href="people.html">People</a></li>
        </ul> <!-- Left Nav Section -->
        <ul class="left">
            <!--<li><a href="#">Left Nav Button</a></li> --></ul>
    </section>
</nav>
<!-- alternative TOPBAR for mobile ********************************************* -->


<div class="row" id="topbarDivSeparator"></div>

<div class="row" id="homeContentArea">
    <div class="small-12 medium-12 large-9 columns" style="padding-left:0;padding-right:15px;" id="divSection1">
        <div id="submenuLinksDiv" style="overflow:visible !important; padding:15px 0 15px 0;width:100%;">
            <div id="submenuLinksDiv1" class="subMenuItem"><a href="#" target="_blank" id="linkInnovationPlatform-hidden" style="color:#ECF0EF !important;">.</a></div>
        </div>

        <div id="divResearch-overall" class="contentSwitchableSection activeSection"> <!--Opens innovationPlatformOveral div ID-->
            <div id="divOverallimage" style="padding:0;width:100%;">
                <ul class="example-orbit" data-orbit data-options="animation:fade;
                  pause_on_hover:true;timer_speed:7000;
                  animation_speed:500;
                  navigation_arrows:false;
                  bullets:false;
                  timer:true; pause_on_hover: true; resume_on_mouseout:true;
                  next_on_click: true;
                  slide_number: false;">
                    <li>
                        <img class="show-for-medium-up" src="../assets/images/top_banners/Research.png" style="width: 100%;" alt="The New Global.Towards a better world."/>
                        <img class="show-for-small-only" src="../assets/images/orange.png" style="width: 100%;" alt="The New Global.Towards a better world."/>

                        <div id="researchSliderCaption1">
                        </div>
                    </li>
                </ul>
            </div> <!--closes divClass "divSection1image"-->
            <div id="divOverall-textAndfeatureImage" style="background-color:#FFF; padding:15px 0 15px 0;vertical-align:top;">
                <div id="divOverall-text"  class="small-9 medium-9 large-9 columns articleText2" style="display:inline-block !important; float:none !important;vertical-align:top;">
                </div> <!--Closes divClass divSection1text-->
                <div id="research-featureimageContactPhotoAndDescription" class="articleText2" style="display:inline-block !important; float:none !important;vertical-align:top; width: 23%;">
                    <div id="research-featureimageContactPhoto" style="width: 100%"><img id="imgOverallphoto1" src="../assets/images/bio_pictures/Henri.png">
                    </div>
                    <div id="researchContactDescriptionDiv">
                        <div id="researchContactSectionTitle" class="articleText2 boldieText">Contact</div>
                        <div id="researchContactName" style="width: 100%;"></div>
                        <div id="researchContactJob" class="articleText2" style="font-style: italic! important; width: 100%;"></div>
                        <div id="researchContactEmail" class="articleText2"></div>
                    </div>
                </div> <!--Closes divClass divSection1text-->
            </div>
        </div> <!--Closes innovationPlatformOveral div ID-->



    </div><!--Closes divSection1-->

    <div class="small-12 medium-12 large-3 columns" style="padding-left:0;padding-right:0;" id="divSection2">
        <div id="relatedItemsDiv" style="overflow:visible !important; padding:15px 0 15px 0; width:100%">
            <div id="relatedItemsTitleDiv" class="relatedMenuItem" style="width: 67%;">
                <a href="#" id="relatedItemsTitleA">Recent posts</a></div>
            <div id="relatedItemsSubTitleDiv" class="relatedMenuItem" style="text-align: right;width:30%;">
                <a href="articles.html" id="relatedItemsSubTitleA" style="font-size: 10px;">All posts>></a></div>
        </div>

        <div id="divSection2container">
            <div id="contentDivContainer" class="contentDivContainerIsotope"></div>
        </div>
    </div>
</div><!-- Closes right pane Div, 3columns wide for Large displays, where the "related items" is positioned-->
</div><!--Closes divSection2-->


<div class="row" id="ModalsHolderDiv-ContentRow">
    <div id="ModalsHolderDiv-Content-about">
        <div id="viewContentModal" class="reveal-modal medium" data-reveal>
            <!--Begins contents of  div for the viewContentModal-->
            <div class="row">
                <div class="large-4 columns" id="viewContentModal-image"></div>
                <div class="large-8 columns">
                    <div class="itemWrapper-fixedWidth" style="padding-right: 10px;padding-bottom: 5px;"><span id="viewContentModal-categories" class="fancyTagBig"></span></div>
                    <div class="itemWrapper-fixedWidth" style="padding-right: 10px;padding-bottom: 5px;"><i class='icon-pencil fancyTextColor font80'></i>&nbsp;<span id="viewContentModal-Author" class="discreetLinks"></span></div>
                    <div class="itemWrapper-fixedWidth" style="padding-right: 10px;padding-bottom: 5px;"><i class='icon-calendaralt-cronjobs fancyTextColor font80'></i>&nbsp;<span id="viewContentModal-Date" class="discreetLinks"></span></div>
                </div>
                <div class="large-8 columns" style="padding-right:0;padding-top: 0;padding-bottom:0;"><div class="content-card-line"><hr></div></div>
                <div class="large-8 columns" style="padding-bottom: 12px;padding-right:10px;padding-top:10px;"><strong><span id="viewContentModal-title" class="hugeTitleText"></span></strong><br></div>
                <div class="large-8 columns" style="padding-right:15px;"><span  id="viewContentModal-excerpt" class="contentCardExcerpt bigTitleText discreetTextColor"></span></div>
            </div>
            <div class="row">
                <div class="large-12 columns" style="height:20px;"></div>
            </div>
            <div class="row">
                <div class="large-12 columns articleText" id="viewContentModal-content" style="padding-left: 15px !important; padding-right: 15px !important;"></div>
            </div>
            <div class="row">
                <div id="viewContentModal-iframes"></div>
            </div>
            <div class="row">
                <div class="large-12 columns">
                    <br>
                    <label class="discreetTextColor">Share:</label>
                    <input type="text" placeholder="" id="articleShareURLinput"/>
                </div>
            </div>
            <div class="row">
                <div class="large-12">
                    <br>
                    <a class="button" id="closeViewContentModal" style="float:right !important;">Close</a>
                </div>
            </div>
            <a class="close-reveal-modal">&#215;</a>
        </div> <!--closes div for the viewContentModal-about-->
    </div>
</div>


<div id="aboutPage"></div>

<!--<div class="aaltoBottomBar contain-to-grid sticky topbar">-->
<div id="bottombar">
    <div class="row">
        <div class="small-12 medium-12 large-12 columns" id="aaltoLogoDiv" style="display:inline-block; margin:auto;">
            <div class="boldieText whiteTextColor" style="font-size:45px; padding:15px 0 0 0;display:inline-block;">A?</div>
            <div class="boldieText whiteTextColor" style="font-size:15px; padding:15px 0 0 0;display:inline-block;">Aalto University</div>
        </div> <!--Closes logoDiv-->
    </div>
</div>
<!--</div>-->

<script src="../assets/js/jquery.js"></script>
<script src="../assets/js/foundation.min.js"></script>
<!--<script src="js/foundation/foundation.js"></script>-->
<script src="../assets/js/foundation/foundation.topbar.js"></script>
<script src="../assets/js/jquery.isotope.js" type="text/javascript"></script>
<script src="../assets/js/jquery.form.min.js"></script>
<script src="../assets/js/jquery.htmlClean.min.js"></script>
<script src="../assets/lib/markdowndeep/MarkdownDeepLib.min.js"></script>
<script src="../assets/js/purl.js"></script>
<script>
    $(document).foundation(
            {
                reveal : {
                    animation: 'fadeAndPop',
                    animation_speed: 250,
                    close_on_background_click: false
                }

            }
    );
</script>
<script>
var getCategoriesOrderedAndFiltered = function(categoryCollection)
{
    var categories = categoryCollection.CollectionContent;
    var orderFilterIDList = categoryCollection.OrderFilterIDList;
    var orderedCategories = [];
    for(i = 0; i < orderFilterIDList.length; i++)
    {
        var currID = orderFilterIDList[i];
        var result = $.grep(categories, function(candidate) { return candidate.ID == currID });
        if(result.length == 0)
            continue;
        var cat = result[0];
        orderedCategories.push(cat);
    }
    return orderedCategories;
};

var getRootCategories = function(categoryCollection)
{
    var orderedCategories = getCategoriesOrderedAndFiltered(categoryCollection);
    var rootCategories = $.grep(orderedCategories, function(candidate) { return !candidate.ParentCategoryID; });
    return rootCategories;
};

var getCategoriesBasedByNamesOrIDs = function(categoryCollection, nameShortTextCollection, categoryIDList)
{
    var orderedCategories = getCategoriesOrderedAndFiltered(categoryCollection);
    var filteredCategories;
    if(categoryIDList)
    {
        var categoryIDArray = categoryIDList.split(",");
        filteredCategories = $.grep(orderedCategories,
                function(candidate) {
                    var foundList = $.grep(categoryIDArray, function(idCandidate) {
                        return idCandidate === candidate.ID;
                    });
                    return foundList.length > 0;
                });
    } else {
        filteredCategories = $.grep(orderedCategories,
                function(candidate) {
                    var foundList = $.grep(nameShortTextCollection.CollectionContent, function(nameCandidate) {
                        return nameCandidate.Content == candidate.CategoryName;
                    });
                    return foundList.length > 0;
                });
    }
    return filteredCategories;
};


var getCardContentFromNode = function (item, imageSizeString) {
    var authors = item.Authors;
    var authorText = "";
    if(authors) {
        var authorNames = $.map(authors.CollectionContent, function(authorContent) {
            return authorContent.Content;
        });
        authorText = authorNames.join(", ");
    }
    var categories = item.Categories;
    var mainCategory = item.Categories[0].Title;
    var imageUrl = item.ImageBaseUrl
            ? item.ImageBaseUrl + "_" + imageSizeString + "x" + imageSizeString + "_crop" + item.ImageExt
            : null;
    return { "id": item.ID, "title": item.Title, "excerpt": item.Excerpt,
        "article_text": item.BodyRendered,
        "image": imageUrl,
        "itemUrl": "../" + item.ActualContentUrl + ".json",
        "author": authorText,
        "categories": categories,
        "mainCategory": mainCategory,
        "published": item.TimestampText
    };
};

$(document).ready(function(){
    $.ajaxSetup({cache: true});

    getAndPopulate_Isotope_Filter_Categories();
    $.when(get_limited_content()).then(function(){start_isotope();
        setInterval(reLayout_isotope, 500);
        get_page_static_content();
        $('img').each(function() {
            $(this).error(function() {
                $(this).attr({
                    /*src: '../assets/images/preview.png',*/
                    alt: 'Sorry! This image is still caching!',
                    class:"hide"
                });
            });
            this.src = this.src;
        });
        get_page_static_content();
        console.log( "Isotope fired after getting content, succeed" );}).fail(function(){console.log( "something went wrong with getting the content" );});
    $("#contentDivContainer").on('mouseover',reLayout_isotope);
    $("#contentDivContainer").delegate(".cardClickableWrapper",{ click: viewContent } );
    $("#closeViewContentModal").click(function () { $('#viewContentModal').foundation('reveal', 'close');});
    $("#schoolsButton").click(function () { $(document).foundation('joyride', 'start');});
    $(".innovationPlatformSubmenuLink").on('click', switchSections);


    function switchSections (event){
        event.preventDefault();
        var triggerid= event.target.id;
        var currentactive=$(".activeSection").attr("id");
        var currentactiveSubmenu=$(".activeLink").attr("id");

        $("#"+currentactive).removeClass("activeSection");
        $("#"+currentactiveSubmenu).removeClass("activeLink");
        $("#"+currentactiveSubmenu).addClass("inactiveLink");
        $("#"+triggerid).removeClass("inactiveLink");
        $("#"+triggerid).addClass("activeLink");

        if (triggerid=="linkInnovationPlatform-mexico"){

            $("#divInnovationPlatform-mexico").addClass("activeSection");}

        if (triggerid=="linkInnovationPlatform-overall"){

            $("#divInnovationPlatform-overall").addClass("activeSection");}

        if (triggerid=="linkInnovationPlatform-tanzania"){

            $("#divInnovationPlatform-tanzania").addClass("activeSection");}

        if (triggerid=="linkInnovationPlatform-india"){

            $("#divInnovationPlatform-india").addClass("activeSection");}
    }

    function getAndPopulate_Isotope_Filter_Categories ()
    {
        var categories="<a href='#' data-filter=':not(.About)' class='current'>All</a>";
        categories+="<a href='#' data-filter='.News'>News</a>";
        categories+="<a href='#' data-filter='.Projects'>Projects</a>";
        categories+="<a href='#' data-filter='.Events'>Events</a>";
        categories+="<a href='#' data-filter='.Stories'>Stories</a>";
        categories+="<a href='about.html' data-filter='.About'>About</a>";
        /*console.log("Entered 'getAndPopulate_Isotope_Filter_Categories' Function.");
         var multihandlerResponse = $.ajax({
         url: "multihandler.php",
         type: "POST",
         data: ({action: 'getMainCategories'}),
         async: false
         }).responseText;*/

        $("#portfolioFilterDivContainer").empty();
        $("#portfolioFilterDivContainer").append(categories);
    }

    function get_limited_content(){
        $("#contentDivContainer").empty();
        return $.getJSON('../../AaltoGlobalImpact.OIP/NodeSummaryContainer/default.json', function(nodeSummaryContainer) {
            nodeSummaryContainer.RootCategories = getRootCategories(nodeSummaryContainer.NodeSourceCategories);
            for(var nodeIX = 0; nodeIX < nodeSummaryContainer.Nodes.CollectionContent.length; nodeIX++)
            {
                var nodeObj = nodeSummaryContainer.Nodes.CollectionContent[nodeIX];
                nodeObj.Categories = getCategoriesBasedByNamesOrIDs(nodeSummaryContainer.NodeSourceCategories, nodeObj.CategoryNames, nodeObj.CategoryIDList);
            }

            var content = nodeSummaryContainer;
            var contentData =
            {
                "CollectionContent": $.map(content.Nodes.CollectionContent, function (item) {
                    return getCardContentFromNode(item, "256");
                })
            };
            var user_content="";
            var counter=1;
            for (var i in contentData.CollectionContent) {
                //noinspection JSUnfilteredForInLoop
                //Check if title is empty... if it is then it is just a category definition so it must be ignored.
                if (counter<=4)
                {
                    counter++;
                    var currItem = contentData.CollectionContent[i];
                    var currentMainCategory = currItem.mainCategory;
                    /*
                     if(currItem.Categories == false || currItem.Categories.CollectionContent == false)
                     currentMainCategory="NEWS";
                     else
                     currentMainCategory=contentData.CollectionContent[i].Categories.CollectionContent[0].Title;
                     */
                    user_content+="<div class='content-card "+currentMainCategory+"' id='contentCardDataId-"+currItem.id+"' data-itemurl='" + currItem.itemUrl + "'>";

                    if (!currItem.image)
                    {
                        var currentImage= "images/preview.jpg";
                    }

                    else
                    {
                        /*var imgID = contentData.CollectionContent[i].ImageData.ID;
                         var imgExtension = contentData.CollectionContent[i].ImageData.AdditionalFormatFileExt;
                         var currentImage= "../../AaltoGlobalImpact.OIP/MediaContent/"+imgID+"_320x240_crop"+imgExtension;*/
                        currentImage = currItem.image;
                    }

                    user_content+="<a href='#' class='cardClickableWrapper'><img src='"+currentImage+"' id='contentCardImage-dataID-"+currItem.id+"'/></a>";
                    user_content+="<a href='#' class='cardClickableWrapper'><div class='content-card-title' style='font-size:95%; font-weight:bold; color:#000000;' id='contentCardTitle-dataID-"+currItem.id+"'>"+currItem.title+"</div></a>";
                    user_content+="<a href='#' class='cardClickableWrapper'><div class='content-card-excerpt content-card-spanExcerpt' id='contentCardExcerpt-dataID-"+currItem.id+"'>"+currItem.excerpt+"</div></a>";
                    /*user_content+="<div class='content-card-line'><hr></div>";*/

                    //------------Beings GENERATING the Author's part
                    i/*f (!currItem.author) var currentAuthor="Aalto Global Impact";
                 else var currentAuthor=currItem.author;
                 user_content+="<div class='content-card-author' id='contentCardAuthor-dataID-"+currItem.id+"'><i class='icon-pencil content-card-spanAuthor'></i>&nbsp;<span class='content-card-spanAuthor'>"+currentAuthor+"</span></div>";*/
                    //---------------ends GENERATING the Author's part

                    /* ---------------Begins calculating date, Hugo's method
                     var recordedJsonDate = contentData.CollectionContent[i].Published;
                     var pattern = /[0-9]+/; //to find the number within the string, first occurrence.
                     recordedJsonDate = (recordedJsonDate.match(pattern))/1000;
                     var extractedDate= new Date(1000*recordedJsonDate);
                     //extractedDate = extractedDate.toLocaleString();
                     var cardDate = extractedDate.getDate()+".";
                     cardDate+= extractedDate.getMonth()+".";
                     cardDate+= extractedDate.getFullYear();
                     ---------------ends calculating date, Hugo's method*/

                    /*----------------Obtaining Date, Kalle's method
                     cardDate = currItem.published;
                     user_content+="<div class='content-card-excerpt' id='contentCardDate-dataID-"+currItem.id+"'><i class='icon-calendaralt-cronjobs content-card-spanAuthor'></i></i>&nbsp;<span class='content-card-spanAuthor'>"+cardDate+"</span></div>";
                     -----------------Obtaining Date, Kalle's method*/
                    /*user_content+="</a>";*/

                    user_content+="<div class='content-card-fancyTag'><div class='fancyTagDiv'>"+currentMainCategory+"</div></div>";
                    user_content+="</div>";
                }//closes "if counter<3;
            }//ends for loop
            $("#contentDivContainer").append(user_content);
        })
    }

    function get_page_static_content(){
        var $caption1div = $("#researchSliderCaption1");
        var $contentDiv = $("#divOverall-text");
        var $nameDiv = $("#researchContactName");
        var $jobDiv = $("#researchContactJob");
        var $emailDiv = $("#researchContactEmail");
            $caption1div.empty();
            $contentDiv.empty();
            $nameDiv.empty();
            $jobDiv.empty();
            $emailDiv.empty();
        return $.getJSON('../../AaltoGlobalImpact.OIP/PagesContent/Research.json', function(contentData) {
                var currItem = contentData.CollectionContent[0];
                /*if ((contentData.CollectionContent[i].Title===null)||(!contentData.CollectionContent[i].Title)||(currItem.Categories===null)){}*/
                    /*if (contentData.CollectionContent[i].ImageData===null) {  var currentImage= "images/preview.jpg"; }
                    else { var imgID = contentData.CollectionContent[i].ImageData.ID;var imgExtension = contentData.CollectionContent[i].ImageData.AdditionalFormatFileExt;var currentImage= "livedata/MediaContent/"+imgID+"_320x240_crop"+imgExtension;}*/
                    var ImageSliderCaption1="<div class='show-for-medium-up orbit-caption fancyTextColor'>"+ currItem.SliderCaption1 + "</div>"+"<div class='show-for-small-only orbit-caption'>" + currItem.SliderCaption1 + "</div>";
                    var caption1=currItem.SliderCaption1;
                    var caption2=currItem.SliderCaption2;
                    var name="<div class='articleText2'>"+currItem.ContactName+"</div>";
                    var job="<div class='articleText2'>"+currItem.ContactTitle+"</div>";
                    var email=currItem.ContactEmail;
                        var emaillink="<div class='articleText2'><a href='#' style='width: 100%;'>"+email+"</a></div>";
                    var content=currItem.Body;
                        $caption1div.append(ImageSliderCaption1);
                        $contentDiv.empty();
                        $contentDiv.append(content);
                        $nameDiv.empty();
                        $nameDiv.append(name);
                        $jobDiv.empty();
                        $jobDiv.append(job);
                        $emailDiv.empty();
                        $emailDiv.append(emaillink);
        })
    }

    function get_content(){
        $("#contentDivContainer").empty();
        return $.getJSON('../../AaltoGlobalImpact.OIP/NodeSummaryContainer/default.json', function(nodeSummaryContainer) {
            nodeSummaryContainer.RootCategories = getRootCategories(nodeSummaryContainer.NodeSourceCategories);
            for(var nodeIX = 0; nodeIX < nodeSummaryContainer.Nodes.CollectionContent.length; nodeIX++)
            {
                var nodeObj = nodeSummaryContainer.Nodes.CollectionContent[nodeIX];
                nodeObj.Categories = getCategoriesBasedByNamesOrIDs(nodeSummaryContainer.NodeSourceCategories, nodeObj.CategoryNames, nodeObj.CategoryIDList);
            }

            var content = nodeSummaryContainer;
            var contentData =
            {
                "CollectionContent": $.map(content.Nodes.CollectionContent, function (item) {
                    /*var rendered = markdown.Transform(item.Excerpt.replaceAll("javascript:", ""));
                     item.ExcerptRendered = rendered;*/
                    return getCardContentFromNode(item, "256");
                })
            };
            var user_content="";
            for (var i in contentData.CollectionContent) {
                //noinspection JSUnfilteredForInLoop
                //Check if title is empty... if it is then it is just a category definition so it must be ignored.                {
                var currItem = contentData.CollectionContent[i];
                var currentMainCategory = currItem.mainCategory;
                /*
                 if(currItem.Categories == false || currItem.Categories.CollectionContent == false)
                 currentMainCategory="NEWS";
                 else
                 currentMainCategory=contentData.CollectionContent[i].Categories.CollectionContent[0].Title;
                 */
                user_content+="<div class='content-card "+currentMainCategory+"' id='contentCardDataId-"+currItem.id+"' data-itemurl='" + currItem.itemUrl + "'>";

                if (!currItem.image)
                {
                    var currentImage= "images/preview.jpg";
                }

                else
                {
                    /*var imgID = contentData.CollectionContent[i].ImageData.ID;
                     var imgExtension = contentData.CollectionContent[i].ImageData.AdditionalFormatFileExt;
                     var currentImage= "../../AaltoGlobalImpact.OIP/MediaContent/"+imgID+"_320x240_crop"+imgExtension;*/
                    currentImage = currItem.image;
                }

                user_content+="<a href='#' class='cardClickableWrapper'><img src='"+currentImage+"' alt='image' id='contentCardImage-dataID-"+currItem.id+"'/></a>";
                user_content+="<div class='content-card-fancyTag'><div class='fancyTagDiv'>"+currentMainCategory+"</div></div>";
                user_content+="<a href='#' class='cardClickableWrapper'><div class='content-card-title' style='font-size:95%; font-weight:bold; color:#000000;' id='contentCardTitle-dataID-"+currItem.id+"'>"+currItem.title+"</div></a>";
                user_content+="<a href='#' class='cardClickableWrapper'><div class='content-card-excerpt content-card-spanExcerpt' id='contentCardExcerpt-dataID-"+currItem.id+"'>"+currItem.excerpt+"</div></a>";
                user_content+="<div class='content-card-line'><hr></div>";
                if (!currItem.author)
                    var currentAuthor="Aalto Global Impact";
                else
                    var currentAuthor=currItem.author;
                user_content+="<div class='content-card-author' id='contentCardAuthor-dataID-"+currItem.id+"'><i class='icon-pencil content-card-spanAuthor'></i>&nbsp;<span class='content-card-spanAuthor'>"+currentAuthor+"</span></div>";
                /*
                 var recordedJsonDate = contentData.CollectionContent[i].Published;
                 var pattern = /[0-9]+/; //to find the number within the string, first occurrence.
                 recordedJsonDate = (recordedJsonDate.match(pattern))/1000;
                 var extractedDate= new Date(1000*recordedJsonDate);
                 //extractedDate = extractedDate.toLocaleString();
                 var cardDate = extractedDate.getDate()+".";
                 cardDate+= extractedDate.getMonth()+".";
                 cardDate+= extractedDate.getFullYear();
                 */
                cardDate = currItem.published;
                user_content+="<div class='content-card-excerpt' id='contentCardDate-dataID-"+currItem.id+"'><i class='icon-calendaralt-cronjobs content-card-spanAuthor'></i></i>&nbsp;<span class='content-card-spanAuthor'>"+cardDate+"</span></div>";
                /*user_content+="</a>";*/
                user_content+="</div>";
            }//ends for loop
            $("#contentDivContainer").append(user_content);
        })
    }

    function start_isotope(){
        //var $container = $('.portfolioContainer');
        var $container = $("#contentDivContainer");
        $container.isotope({
            filter: ':not(.About)',
            animationOptions: {
                duration: 750,
                easing: 'linear',
                queue: false
            }
        });

        $('.portfolioFilter a').click(function(){

            console.log ("Entered the Isotope Filter click event handler.")
            $('.portfolioFilter .current').removeClass('current');
            $(this).addClass('current');

            var selector = $(this).attr('data-filter');

            if (selector==".About") {
                /*$("#photoBannerContainerRow").removeClass("show-for-medium-up");
                 $("#photoBannerContainerRow").removeClass("photoBannerContainerRow");
                 $("#photoBannerContainerRow").addClass("hide");
                 $("#isotope_content_row").addClass("hide");
                 $("#aboutPage").removeClass("hide");
                 $("body").css("background-color", "#f0f0f2");
                 $("#aboutPage").load("about.html");
                 $(document).foundation('orbit');*/
                window.location.href = "about.html";
            }
            else
            {
                /*$("#photoBannerContainerRow").addClass("show-for-medium-up");
                 $("#photoBannerContainerRow").addClass("photoBannerContainerRow");
                 $("#aboutPage").addClass("hide");
                 $("body").css("background-color", "");
                 $("#photoBannerContainerRow").removeClass("hide");
                 $("#isotope_content_row").removeClass("hide");*/
                $container.isotope({
                    filter: selector,
                    animationOptions: {
                        duration: 750,
                        easing: 'linear',
                        queue: false }  });
            } //closes else
            return false;
        });
    }//closes function Start_isotope

    function reLayout_isotope() {
        var $container = $('#contentDivContainer');
        $container.isotope( 'reLayout');
    }

    String.prototype.replaceAll = function(strReplace, strWith) {
        var reg = new RegExp(strReplace, 'ig');
        return this.replace(reg, strWith);
    };

    function openArticle(articleType, articleID) {
        var articleUrl;
        if(articleType == "text")
            articleUrl = "../../AaltoGlobalImpact.OIP/TextContent/" + articleID + ".json";
        openArticleUrl(articleUrl);
    }

    function openArticleUrl(articleUrl) {
        $.getJSON(articleUrl, function(textContent) {
            console.log("Entered the 'openArticleURl' function");

            var iFrameList = [];
            if(textContent.IFrameSources) {
                var nonTaggedList = textContent.IFrameSources.split('\n');
                $.each(nonTaggedList, function(index, value) {
                    var taggedVersion = "<iframe " + value + "></iframe>";
                    iFrameList.push(taggedVersion);
                });
            }
            var contentData = { "CollectionContent": [ textContent ] };
            var queryValue="";
            markdown = new MarkdownDeep.Markdown();
            markdown.SafeMode = true;
            var i = 0;

            queryValue=contentData.CollectionContent[i].Title;
            $("#viewContentModal-title").empty();
            $('#viewContentModal-title').append(queryValue);

            queryValue="<p>"+contentData.CollectionContent[i].Excerpt+"</p>";
            $("#viewContentModal-excerpt").empty();
            $('#viewContentModal-excerpt').append(queryValue);

            //var currentMainCategory=contentData.CollectionContent[i].Categories.CollectionContent[0].Title;
            var currentMainCategory="News";

            //queryValue=contentData.CollectionContent[i].content_type;
            $("#viewContentModal-categories").empty();
            $('#viewContentModal-categories').append(currentMainCategory);

            var rawbody;
            rawbody = contentData.CollectionContent[i].RawHtmlContent;
            if(rawbody) {
                //$.htmlClean.defaults.allowedTags = ["p", "em"];
                //$.htmlClean.defaults.replace = [["div","br"], "p"];
                /*queryValue=clean(rawbody,
                 {
                 replace:[["div", "br"], "p"],
                 allowedTags:["p","em","strong","a","img","ol","ul","li"]
                 });*/
                /*queryValue = clean(rawbody);*/
                rawbody=rawbody.replace(new RegExp("div", "g"), 'p');
                rawbody=rawbody.replace(new RegExp("<span>", "g"), '');
                rawbody=rawbody.replace(new RegExp("</span>", "g"), '');
                /*rawbody=rawbody.replace(new RegExp("<br/>", "g"), '<p></p>');
                 rawbody=rawbody.replace(new RegExp("<br>", "g"), '<p></p>');
                 rawbody=rawbody.replace(new RegExp("</br>", "g"), '<p></p>');*/

                queryValue=$.htmlClean(rawbody, {format:true});
            } else {
                var bodyRendered = markdown.Transform(contentData.CollectionContent[i].Body.replaceAll("javascript:", ""));
                rawbody = bodyRendered;
                queryValue = rawbody;
            }


            //queryValue=$.htmlClean(rawbody, {format:false});

            //queryValue=contentData.CollectionContent[i].Body;
            $("#viewContentModal-content").empty();
            $('#viewContentModal-content').append(queryValue);

            var lastSlashIndex = articleUrl.lastIndexOf("/");
            var lastExtIndex = articleUrl.lastIndexOf(".json");
            var articleIDFromArticleUrl = articleUrl.substring(lastSlashIndex + 1, lastExtIndex);
            var currentURL = "http://www.aaltoglobalimpact.org/html/index.html?type=text&id="+ articleIDFromArticleUrl;
            $("#articleShareURLinput").attr("placeholder",currentURL);
            $("#articleShareURLinput").val(currentURL);
            /*$("#articleShareURLinput").attr("disabled", true);*/

            if ((contentData.CollectionContent[i].Author===null)||(!contentData.CollectionContent[i].Author) )
                var currentAuthor="Aalto Global Impact";
            else
                var currentAuthor=contentData.CollectionContent[i].Author;
            queryValue=contentData.CollectionContent[i].Author;
            $("#viewContentModal-Author").empty();
            $('#viewContentModal-Author').append(currentAuthor);

            var recordedJsonDate = contentData.CollectionContent[i].Published;
            var pattern = /[0-9]+/; //to find the number within the string, first occurrence.
            recordedJsonDate = (recordedJsonDate.match(pattern))/1000;
            var extractedDate= new Date(1000*recordedJsonDate);
            //extractedDate = extractedDate.toLocaleString();
            var cardDate = extractedDate.getDate()+".";
            cardDate+= extractedDate.getMonth()+".";
            cardDate+= extractedDate.getFullYear();

            $("#viewContentModal-Date").empty();
            $('#viewContentModal-Date').append(cardDate );

            //send the correspondent image to the placeholder, but clean its containing div first
            if (contentData.CollectionContent[i].ImageData===null)
            {
                var currentImage= "images/preview.jpg";
            }

            else
            {
                var imgID = contentData.CollectionContent[i].ImageData.ID;
                var imgExtension = contentData.CollectionContent[i].ImageData.AdditionalFormatFileExt;
                var currentImage= "../../AaltoGlobalImpact.OIP/MediaContent/"+imgID+"_320x240_crop"+imgExtension;
            }
            $("#viewContentModal-image").empty(); //clean the image Placeholder in the form
            queryValue = "<img src='"+currentImage+"' style='width:auto;height:auto;max-width:350;max-height:450px;margin-left:auto;margin-right:auto;'>";
            $("#viewContentModal-image").append(queryValue);


            $("#viewContentModal-iframes").empty();
            $.each(iFrameList, function(index, value) {
                $("#viewContentModal-iframes").append(value);
            });


            $('#viewContentModal').foundation('reveal', 'open');
        }) //ends getJson
    }

    function viewContent(editEvent) {
        console.log ("Entered 'viewContent' function. Triggered ID: "+editEvent.target.id);
        editEvent.preventDefault();
        var currentId=editEvent.target.id;
        var currentId2 = $('#'+currentId).parents(".content-card").attr('id');
        var clickedEditID= currentId2.replace("contentCardDataId-", '');
        var articleUrl = $('#'+currentId).parents(".content-card").data('itemurl');
        openArticleUrl(articleUrl);
    }//Ends Function ViewContent

    $(function () {
        var openArticleType = $.url().param("type");
        var openArticleID = $.url().param("id");
        if(openArticleType && openArticleID) {
            window.history.pushState("string", "Aalto Global Impact", "index.html");
            openArticle(openArticleType, openArticleID);
        }
    });



});
</script>
</body>
</html>
